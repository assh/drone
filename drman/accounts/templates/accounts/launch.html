{% extends 'accounts/main.html' %}
{% load static %}
{% load thumbnail %}

{% block head %}


<script src='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v1.12.0/mapbox-gl.css' rel='stylesheet' />

<!-- PubNub CDN -->
<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.19.0.min.js"></script>

{% endblock %}

{% block content %}
<div class="container">
    <div class="row">


        <div class="card">
            <div class="card-body">
                <h2 class=" card text-light card-title text-center pb-1" id="headlaunch">Mission Details</h2>
                <br>
                <div class="row">
                    <div class="col-md mx-5 my-2">
                        <h4>Mission ID:</h4>
                    </div>
                    <div class="col-md text-center">
                        <h5>{{mission.mission_id}}</h5>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md mx-5 my-2">
                        <h4>Servicing Drone Station:</h4>
                    </div>
                    <div class="col-md text-center">
                        <h4>{{mission.state}}</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md mx-5 my-2">
                        <h4>Drone Assigned:</h4>
                    </div>
                    <div class="col-md text-center">
                        <h4>{{mission.drone}}</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md mx-5 my-2">
                        <h4>Mission Type:</h4>
                    </div>
                    <div class="col-md text-center">
                        {% if mission.mission_type == '1' %}
                        <h4>Loiter</h4>
                        {% elif mission.mission_type == '2' %}
                        <h4>Circumferance</h4>
                        {% else %}
                        <h4>Comprehensive</h4>
                        {% endif %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-md mx-5 my-2">
                        <h4>Mission Status:</h4>
                    </div>
                    <div class="col-md text-center">
                        <h4>{{mission.mission_status}}</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md mx-5 my-2">
                        <h4>Mission Manager:</h4>
                    </div>
                    <div class="col-md text-center">
                        <h4>{{mission.manager}}</h4>
                    </div>
                </div>

                <br>
                <div class="row">
                    <div class="col-md">
                        <a href="{% url 'update-mission' mission.id %}"
                            class="btn btn-primary btn-lg btn-block">Update</a>
                    </div>
                    <div class="col-md">
                        <a href="#" class="btn btn-danger btn-lg btn-block">Delete</a>
                    </div>
                </div>

            </div>

        </div>
        <div class="card">
            <div id='map' style='width: 500px; height: 600px;'></div>

            <!-- <div class="card-body">
                <h5 class="card-title">Mission Map</h5>
                {% thumbnail mission.mission_pic "500x500" crop="center" as im %}
                <a href="{{ im.url }}"><img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}"></a>
                {% endthumbnail %}

            </div> -->
        </div>
    </div>
</div>

{% endblock %}

{% block js %}
<script>
    window.lat = 25.351222;
    window.lng = 55.387197;

    // function getLocation() {
    //     if (navigator.geolocation) {
    //         navigator.geolocation.getCurrentPosition(updatePosition);
    //     }
      
    //     return null;
    // };
    // function updatePosition(position) {
    //   if (position) {
    //     window.lat = position.coords.latitude;
    //     window.lng = position.coords.longitude;
    //   }
    // }
    // setInterval(function(){updatePosition(getLocation());}, 10000);
      
    // function currentLocation() {
    //   return {lat:window.lat, lng:window.lng};
    // };




    var map;
    var mark;
    var lineCoords = [];

    
    

    mapboxgl.accessToken = 'pk.eyJ1IjoiYXNzaHBhbiIsImEiOiJja2Z2ejkxcnEwZnU2MnlwN2g0NDZhY3VwIn0.WYMqF3Ih2Quk24PjbF42QQ';
    map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [55.387197,25.351222],
    zoom: 12
    });
    map.addControl(new mapboxgl.NavigationControl());

    var redraw = function(payload){
        lat = payload.message.lat;
        lng = payload.message.lng;
        map.setCenter([lng,lat]);
        mark.setLngLat([lng,lat]);
    }


var c1 = new mapboxgl.Marker()
.setLngLat([parseFloat("{{mission.c12}}"),parseFloat("{{mission.c11}}") ])
.addTo(map);

var c1 = new mapboxgl.Marker()
.setLngLat([parseFloat("{{mission.c22}}"),parseFloat("{{mission.c21}}") ])
.addTo(map);

var c1 = new mapboxgl.Marker()
.setLngLat([parseFloat("{{mission.c32}}"),parseFloat("{{mission.c31}}") ])
.addTo(map);

var c1 = new mapboxgl.Marker()
.setLngLat([parseFloat("{{mission.c42}}"),parseFloat("{{mission.c41}}") ])
.addTo(map);




    var pnChannel = "{{mission.mission_id}}";
    var pubnub = new PubNub({
      subscribeKey: 'sub-c-886f557a-0307-11eb-88da-261b8c980873'
    });

    pubnub.subscribe({channels: [pnChannel]});
    pubnub.addListener({message:redraw});

    // setInterval(function() {
    //   pubnub.publish({channel:pnChannel, message:{lat:window.lat + 0.001, lng:window.lng + 0.01}});
    // }, 2000);

    

    </script>
{% endblock %}